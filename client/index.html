<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Snippet Stack</title>
    <link rel="icon" href="/public/favicon.ico" sizes="32x32" />
    <link rel="stylesheet" href="/src/style.css" />
  </head>
  <body>
    <header>
      <div id="header-top-container">
        <img id="header-logo" src="/assets/images/logo.png" alt="Logo" />
        <span id="header-text">SNIPPET STACK</span>
        <button id="create-note-button" type="submit">Create âœ™</button>
      </div>
      <div id="header-bottom-container-navbar"></div>
    </header>
    <div id="notes-container"></div>
    <script type="module">
      import { createNote } from "./src/components/createNote.js"
      import { noteCard } from "./src/components/noteCard.js"
      const createNoteButton = document.getElementById("create-note-button")
      const notesContainer = document.getElementById("notes-container")

      createNoteButton.addEventListener("click", async () => {
        try {
          // Use createNote and post the noteData to backend
          const noteData = await createNote(["hello"], document.body)
          const response = await fetch("https://snippet-stack-server.vercel.app/api/v1/notes", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(noteData),
          })
          const result = await response.json()
          console.log("Status:", result.message)
          // Empty the notes container on submit button click and repopulate
          notesContainer.innerHTML = ""
          await populateNoteCard()
        } catch (err) {
          console.log(`Error in POST noteData:${err}`)
        }
      })

      const populateNoteCard = async () => {
        try {
          // Fetch notes data from backend and populate noteCard
          const noteData = await fetch("https://snippet-stack-server.vercel.app/api/v1/notes/get")
          const response = await noteData.json()
          response.forEach(async (element) => {
            const { id, image_url, created_at, title, description } = element
            await noteCard(id, image_url, created_at, title, description)
          })
        } catch (error) {
          console.log(error)
        }
      }

      populateNoteCard()
    </script>
  </body>
</html>
